{% extends 'layout/base.html' %}

{% block content %}

<head>
    <link href="{{ url_for('static', filename='css/cart.css') }}" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" rel="stylesheet"/>
</head>

<h1 class="text-center">GIỎ HÀNG</h1>

{% if 'cart' in session and session['cart'] %}

<div class="cart-table">
    <div class="cart-table-inner">
        <table class="table">
            <tr>
                <th>Mã sản phẩm</th>
                <th>Tên sản phẩm</th>
                <th>Đơn giá</th>
                <th>Số lượng</th>
                <th></th>
            </tr>
            {% for c in session['cart'].values() %}
            <tr id="cart{{ c.id }}">
                <td>{{ c.id }}</td>
                <td>{{ c.name }}</td>
                <td>{{ "{:,.0f}".format(c.price) }} VNĐ</td>
                <td>
                    <input type="number" value="{{ c.quantity }}" onblur="updateCart({{ c.id }}, this)"
                           class="form-control"/>
                </td>
                <td>
                    <input type="button" value="Xóa" onclick="deleteCart({{ c.id }})" class="btn btn-danger"/>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>

<div class = "pay-infor">
    <div class="pay-infor-left alert-total alert">
        <div class="alert-total-inner">
            <h3>Tổng sản phẩm: <span class="cart-counter">{{ cart.total_quantity }}</span></h3>
            <h3>Tổng tiền: <span class="cart-amount">{{ "{:,.0f}".format(cart.total_amount) }} VNĐ</span></h3>
        </div>
    </div>

    <div class="pay-infor-right total-pay">
        {% if current_user.is_authenticated %}
        <div class="payment-methods">
            <h4>Chọn phương thức thanh toán:</h4>
            <div class="payment-options">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="payment_method" id="cash" value="1" checked>
                    <label class="form-check-label" for="cash">
                        <i class="fas fa-money-bill-wave"></i> Tiền mặt
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="payment_method" id="bank_transfer" value="2">
                    <label class="form-check-label" for="bank_transfer">
                        <i class="fas fa-university"></i> Chuyển khoản ngân hàng
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="payment_method" id="momo" value="3">
                    <label class="form-check-label" for="momo">
                        <i class="fas fa-mobile-alt"></i> MoMo
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="payment_method" id="zalopay" value="4">
                    <label class="form-check-label" for="zalopay">
                        <i class="fas fa-credit-card"></i> ZaloPay
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="payment_method" id="vnpay" value="5">
                    <label class="form-check-label" for="vnpay">
                        <i class="fas fa-credit-card"></i> VNPay
                    </label>
                </div>
            </div>
        </div>
        <button type="button" class="btn btn-success" id="pay-button" style="margin-top: 10px; width: 100%; padding: 10px;">Thanh toán</button>
        {% else %}
        <p>Vui lòng <a href="/login?next=/cart">đăng nhập</a> để thanh toán!</p>
        {% endif %}
    </div>
</div>

{% else %}
<div class = "nothing-cart">
    <p>Giỏ không có hàng!</p>
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Kiểm tra nút thanh toán
    const payButton = document.getElementById('pay-button');
    if (payButton) {
        payButton.addEventListener('click', function(e) {
            e.preventDefault();
            pay();
        });
    }
});
</script>

{% endblock %}